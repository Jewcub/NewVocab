<!DOCTYPE html> <!-- The new doctype -->
<html>
<head> <!-- No title and meta tags are necessary for the extension -->

<!--<link rel="stylesheet" type="text/css" href="style.css" />-->
<script type="text/javascript" src="jquery-1.7.2.min.js"></script>
<!--<script type="text/javascript" src="data.js"></script>-->

<script type="text/javascript">
	function build_fixer(list) {
		var data = JSON.stringify(list);
		return [
			"(function() {",
			//"var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;",
			"var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = false;",
			"ga.textContent = 'NewVocab_data = " + data + ";';",
			"var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);",
			"console.log('Inlined');",
			"})();",
		].join('\n')
	}

	//console.log(build_fixer(["ala", "kot"]));

	$(document).ready(function() {
		$('.limit_select').live('click', function () {
			console.log("Clicked");
			//chrome.tabs.executeScript({'file': 'content.js'});

			// chrome.tabs.executeScript({'file': 'data.js'}, function() {
			// 	console.log("Loading content.js");
			// 	chrome.tabs.executeScript({'file': 'content.js'});
			// });

			chrome.tabs.executeScript({'code': build_fixer(NewVocab_data.slice(0, 10)), 'runAt': 'document_start'}, function() {
				console.log("Loading content.js");
				chrome.tabs.executeScript({'file': 'content.js', 'runAt': 'document_end'});
			});

			$.ajax({url: "data.js"}).done(function(data) {
				//alert(data.substring(0, 111));
				$.ajax({url: "content.js"}).done(function(content) {
					//alert(content.substring(0, 111));
					var generated = data + '\n\n' + content + '\n\n' + 'alert("super " + NewVocab_data.length);'
					chrome.tabs.executeScript({'code': generated}, function() {
					 	console.log("done content.js");
					 });
				});
			});

			// chrome.tabs.executeScript({'code': 'alert("super")'}, function() {
			// 	console.log("Loading content.js");
			// 	chrome.tabs.executeScript({'file': 'content.js', 'runAt': 'document_end'});
			// });
		});
	});
</script>

<style>
	body {
		overflow: hidden;
		margin: 5px;
		padding: 0px;
		width: 200px;
	}
</style>

</head>

<body>
	<h1>New Vocabulary</h1>

	<a href="#" class="limit_select" id="1k">1k</a>
	<a href="#" class="limit_select" id="2k">2k</a>
	<a href="#" class="limit_select" id="3k">3k</a>
	<a href="#" class="limit_select" id="4k">4k</a>
	<a href="#" class="limit_select" id="5k">5k</a>

	<a href="#" class="limit_select" id="6k">6k</a>
	<a href="#" class="limit_select" id="7k">7k</a>
	<a href="#" class="limit_select" id="8k">8k</a>
	<a href="#" class="limit_select" id="9k">9k</a>
	<a href="#" class="limit_select" id="10k">10k</a>
</body>
</html>
